# RuneBingo MVP

[![Epic](https://img.shields.io/github/issues/detail/title/RuneBingo/RuneBingo/11?label=%2311&color=blue)](https://github.com/RuneBingo/RuneBingo/issues/11)

As a bingo organizer, I want to be able to create an event, setup its description and tiles, invite people, create and manage teams, approve or reject tile completion requests, start and end the event.

## Table of Contents

- [Requirements](#requirements)
- [Specifications](#specifications)
  - [Entities](#entities)
  - [Commands](#commands)
  - [Events](#events)
  - [Queries](#queries)
  - [API endpoints](#api-endpoints)
- [Frontend](#frontend)
  - [Architecture](#architecture)
  - [Pages](#pages)

## Requirements

- [ ] Users can sign up and sign in, either via or the API or the web app.
- [ ] Users can change their display name & language
- [ ] Users can create a bingo event, with a title, description (WYSIWYG), privacy, expected start date, and a set of tiles
  - [ ] For the MVP, tiles will be OSRS Item(s), with a name, description, and (optional) custom image
- [ ] Users can browse public bingo events and apply to join them if they are not full, private or already started
- [ ] Bingo managers can invite other users to join their event
- [ ] Bingo managers can create teams and assign users, or invitations to them
- [ ] Bingo managers can approve or reject user bingo applications
- [ ] Bingo managers can start an event if all tiles have been created, and all players have been assigned to a team
- [ ] Bingo managers can end an event
- [ ] Participants can request tile completions for their team, with a screenshot and a comment
- [ ] Bingo managers can approve or reject tile completion requests
- [ ] Bingo managers can view an activity feed of activities related to the bingo event

## Specifications

### Entities

#### User

We need to add the following column to the Users table:

| Column               | Type   | Null    | Description                                                                        |
| -------------------- | ------ | ------- | ---------------------------------------------------------------------------------- |
| `role`               | string | `false` | The user's role in the application. Can be `user`, `moderator`, or `admin`.        |
| `username`           | string | `false` | The user's display name. This will allow other users to find them. Must be unique. |
| `usernameNormalized` | string | `false` | The normalized version of the username, for search queries. Must be unique.        |
| `gravatarHash`       | string | `true`  | A hash to associate the user's email with a Gravatar image.                        |

The role will be set to `user` for all existing users. There won't be a way to manually change this for now, but it will be useful to implement the appropriate permission checks for the API. The column `isSuperAdmin` will be removed.

The username columns are not nullable, so the migration will set their value to the left part (before the `@`) of the `email` and `emailNormalized` columns. This is to prevent having incomplete users in the database, so this will reduce the number of filters we need to apply when querying the database.

For the `gravatarHash`, the migration will need to iterate programmatically over all users and set the value to the SHA-256 hash of their `emailNormalized` column.

#### Bingo

The Bingo entity represents an event where users can participate. It is a strong paranoid entity, but we won't mention these columns. It will have the following columns:

| Column          | Type     | Null    | Description                                                                                                                                 |
| --------------- | -------- | ------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| `uuid`          | string   | `false` | The public unique identifier of the bingo event.                                                                                            |
| `language`      | string   | `false` | The base language of the event. Will be used for translating user content later.                                                            |
| `title`         | string   | `false` | The title of the event.                                                                                                                     |
| `description`   | string   | `false` | The description of the event, in HTML format.                                                                                               |
| `private`       | boolean  | `false` | Whether the event is private or not.                                                                                                        |
| `width`         | number   | `false` | The width of the bingo board. Defaults to 5.                                                                                                |
| `height`        | number   | `false` | The height of the bingo board. Defaults to 5.                                                                                               |
| `fullLineValue` | number   | `true`  | The amount of points completing a full line (column, row or diagonal) would award to the team. Must be a positive intege. Must have a value |
| `startDate`     | datetime | `true`  | The expected start date of the event.                                                                                                       |
| `endDate`       | datetime | `true`  | The expected end date of the event.                                                                                                         |
| `startedAt`     | datetime | `true`  | The actual start date of the event.                                                                                                         |
| `startedBy`     | number   | `true`  | The ID of the user who started the event.                                                                                                   |
| `endedAt`       | datetime | `true`  | The end date of the event.                                                                                                                  |
| `endedBy`       | number   | `true`  | The ID of the user who ended the event.                                                                                                     |
| `cancelledAt`   | datetime | `true`  | The cancellation date of the event.                                                                                                         |
| `cancelledBy`   | number   | `true`  | The ID of the user who cancelled the event.                                                                                                 |

The `startDate` and `endDate` columns are here for information purposes, there won't be automatic start for now.

#### BingoParticipant

The BingoParticipant is a mapping between a user and a bingo, allowing to track their role, participation and team. It is a base paranoid entity. It will have the following columns:

| Column    | Type   | Null    | Description                                                                       |
| --------- | ------ | ------- | --------------------------------------------------------------------------------- |
| `userId`  | number | `false` | The ID of the user participating in the event.                                    |
| `bingoId` | string | `false` | The id of the bingo event the user is participating in.                           |
| `role`    | string | `false` | The role of the user in the event. Can be `participant`, `organizer`, or `owner`. |
| `teamId`  | number | `true`  | The ID of the team the user is part of.                                           |

#### BingoTile

A bingo is made of 25 tiles, each representing a task to complete. It is a base paranoid entity. It will have the following columns:

| Column           | Type    | Null    | Description                                                                                                                       |
| ---------------- | ------- | ------- | --------------------------------------------------------------------------------------------------------------------------------- |
| `bingoId`        | string  | `false` | The id of the bingo event the tile is part of.                                                                                    |
| `x`              | number  | `false` | The x coordinate of the tile on the bingo board. It ranges from 0 to the `width` of the related Bingo, minus one.                 |
| `y`              | number  | `false` | The y coordinate of the tile on the bingo board. It ranges from 0 to the `height` of the related Bingo, minus one.                |
| `value`          | number  | `false` | The amount of points completing this tile would award to the team. Must be a positive integer.                                    |
| `free`           | boolean | `false` | Whether the tile is free or not. If it is, it will be automatically completed for all teams. Defaults to `false`.                 |
| `title`          | string  | `false` | The title of the tile.                                                                                                            |
| `description`    | string  | `false` | The description of the tile.                                                                                                      |
| `completionMode` | string  | `false` | The completion mode of the tile. Can be `all` if all items must be acquired, or `any` if only one is required. Defaults to `any`. |
| `imageUrl`       | string  | `true`  | The URL of the image associated with the tile.                                                                                    |

#### BingoTileItem

A BingoTile can be associated with zero to many OSRS items. This will be used for tracking with the RuneLite plugin later. The BingoTileItem entity is a base paranoid entity. It will have the following columns:

| Column     | Type   | Null    | Description                                                            |
| ---------- | ------ | ------- | ---------------------------------------------------------------------- |
| `tileId`   | number | `false` | The ID of the bingo tile the item is associated with.                  |
| `itemId`   | number | `false` | The ID of the OSRS item the tile is associated with.                   |
| `quantity` | number | `false` | The quantity of the item required to complete the tile. Defaults to 1. |

#### BingoTeam

A BingoTeam is a group of users participating together in a Bingo event. It is a strong paranoid entity. It may also have a captain, which would not give any special role within the application, but would be useful for managers and it will be displayed with the team.

| Column           | Type   | Null    | Description                                                                                           |
| ---------------- | ------ | ------- | ----------------------------------------------------------------------------------------------------- |
| `bingoId`        | string | `false` | The id of the bingo event the team is part of.                                                        |
| `name`           | string | `false` | The name of the team. Must be unique for a specific `bingoId`.                                        |
| `nameNormalized` | string | `false` | The normalized version of the team name, for search queries. Must be unique for a specific `bingoId`. |
| `captainId`      | number | `true`  | The ID of the user who is the captain of the team, if any.                                            |
| `points`         | number | `false` | The amount of points the team has. Defaults to 0.                                                     |

#### BingoInvitation

A BingoInvitation can be created by bingo organizers and owners. It allows them to invite users to join their event. It is a base paranoid entity. It will have the following columns:

| Column        | Type     | Null    | Description                                                                |
| ------------- | -------- | ------- | -------------------------------------------------------------------------- |
| `uuid`        | string   | `false` | The public unique identifier of the invitation.                            |
| `bingoId`     | string   | `false` | The id of the bingo event the invitation is part of.                       |
| `teamId`      | number   | `true`  | The ID of the team the user will be part of if they accept the invitation. |
| `senderId`    | number   | `false` | The ID of the user who sent the invitation.                                |
| `recipientId` | number   | `false` | The ID of the user who received the invitation.                            |
| `acceptedAt`  | datetime | `true`  | The date the invitation was accepted.                                      |
| `rejectedAt`  | datetime | `true`  | The date the invitation was rejected.                                      |

Only one invitation per receiver can be pending at a time.

#### BingoApplication

A BingoApplication can be created by users to join a bingo event. It is a base paranoid entity. It will have the following columns:

| Column       | Type     | Null    | Description                                                       |
| ------------ | -------- | ------- | ----------------------------------------------------------------- |
| `uuid`       | string   | `false` | The public unique identifier of the application.                  |
| `teamId`     | number   | `true`  | The ID of the team the user will be part of if they are accepted. |
| `userId`     | number   | `false` | The ID of the user who sent the application.                      |
| `bingoId`    | string   | `false` | The id of the bingo event the application is part of.             |
| `acceptedAt` | datetime | `true`  | The date the application was accepted.                            |
| `acceptedBy` | number   | `true`  | The ID of the user who accepted the application.                  |
| `rejectedAt` | datetime | `true`  | The date the application was rejected.                            |
| `rejectedBy` | number   | `true`  | The ID of the user who rejected the application.                  |

Only one application per user can be pending at a time.

#### BingoTileCompletion

Users may create BingoTileCompletions for their team to mark a tile as completed, and get the points associated with it. It is a base paranoid entity. It will have the following columns:

| Column       | Type   | Null    | Description                                               |
| ------------ | ------ | ------- | --------------------------------------------------------- |
| `uuid`       | string | `false` | The public unique identifier of the completion.           |
| `bingoId`    | string | `false` | The ID of the bingo event the completion is for.          |
| `x`          | number | `false` | The x coordinate of the bingo tile the completion is for. |
| `y`          | number | `false` | The y coordinate of the bingo tile the completion is for. |
| `teamId`     | number | `false` | The ID of the team the completion is for.                 |
| `userId`     | number | `false` | The ID of the user who sent the completion.               |
| `imageUrl`   | string | `false` | The URL of the picture of the completion.                 |
| `acceptedAt` | string | `true`  | The date the completion was accepted.                     |
| `acceptedBy` | number | `true`  | The ID of the user who accepted the completion.           |
| `rejectedAt` | string | `true`  | The date the completion was rejected.                     |
| `rejectedBy` | number | `true`  | The ID of the user who rejected the completion.           |

### Commands

#### `CreateUserCommand`

The command must now fail if the requester isn't `'self'`, or an admin.

The command will be modified to include the username. The `usernameNormalized` column will be set to the normalized version of the username. The `gravatarHash` will be set to the SHA-256 hash of the `emailNormalized` column.

#### `SignInWithEmailCommand`

This command will send an email even if the user doesn't exist. The Redis key will be `auth:email:<emailNormalized>`, and the value will now be:

```json
{
  "action": "sign-in",
  "email": "string"
}
```

#### `SignUpWithEmailCommand`

```ts
type Params = {
  email: string;
  username: string;
};
```

If the username's normalized version already exists, the command will fail. If the email already exists, the user will be sent a sign in code via email.

Otherwise, the user will receive a sign up code via email. The code will be saved in Redis, just like sign in codes, but it will contain the username as well. The key will be `auth:email:<emailNormalized>`, and the value will be:

```json
{
  "action": "sign-up",
  "email": "string",
  "username": "string"
}
```

#### `SignOutSessionByUuidCommand`

This command must now fail if the requester isn't the owner of the session, or an admin.

#### `UpdateUserCommand`

```ts
type Params = {
  requester: User;
  username: string;
  updates: {
    username?: string;
    language?: 'en' | 'fr';
  };
};
```

Allows the user to update their username and language. The command must fail if:

- the user doesn't exist
- the requester is neither the user nor a moderator or admin
- the new username is invalid or already taken
- the new language is invalid

The new username will be normalized and saved in the `usernameNormalized` column.

An `UserUpdatedEvent` will then be emitted.

#### Other commands

Since the [API endpoints](#api-endpoints) section will be pretty comprehensive, we'll simply list the commands we need to implement:

- `CreateBingoCommand`: Creates a new bingo event.
- `UpdateBingoCommand`: Updates a bingo event before it starts.
- `StartBingoCommand`: Starts a bingo event.
- `EndBingoCommand`: Ends a bingo event.
- `CancelBingoCommand`: Cancels a bingo event.
- `DeleteBingoCommand`: Deletes a bingo event.
- `ApplyToBingoCommand`: Creates an application for a user to join a bingo.
- `AcceptBingoApplicationCommand`: Accepts a bingo application.
- `RejectBingoApplicationCommand`: Rejects a bingo application.
- `CreateBingoInvitationCommand`: Invites a user to a bingo event.
- `AcceptBingoInvitationCommand`: Accepts a bingo invitation.
- `RejectBingoInvitationCommand`: Rejects a bingo invitation.
- `DeleteBingoInvitationCommand`: Deletes a bingo invitation.
- `AddParticipantCommand`: Adds a participant to a bingo event.
- `RemoveParticipantCommand`: Removes a participant from a bingo event.
- `UpdateParticipantCommand`: Updates a participant's role or team.
- `CreateTeamCommand`: Creates a new team within a bingo event.
- `UpdateTeamCommand`: Updates a team's details.
- `DeleteTeamCommand`: Deletes a team from a bingo event.
- `AddBingoTileCommand`: Adds a tile to a bingo event.
- `UpdateBingoTileCommand`: Updates a tile in a bingo event.
- `DeleteBingoTileCommand`: Deletes a tile from a bingo event.
- `SubmitTileCompletionCommand`: Submits a tile completion request.
- `AcceptTileCompletionCommand`: Approves a tile completion request.
- `RejectTileCompletionCommand`: Rejects a tile completion request.

### Events

#### `UserUpdatedEvent`

```ts
type Params = {
  userId: string;
  requesterId: string;
  updates: {
    username?: string;
    language?: 'en' | 'fr';
  };
};
```

The event handler will create an activity with key `user.updated` and the event payload as the parameters.

#### Other events

Here is a list of the other events we need to implement:

- `BingoCreatedEvent`: A new bingo event has been created.
- `BingoUpdatedEvent`: A bingo event has been updated.
- `BingoStartedEvent`: A bingo event has started.
- `BingoEndedEvent`: A bingo event has ended.
- `BingoCanceledEvent`: A bingo event has been cancelled.
- `BingoDeletedEvent`: A bingo event has been deleted.
- `BingoApplicationCreatedEvent`: A user applied to join a bingo.
- `BingoApplicationAcceptedEvent`: A bingo application was accepted.
- `BingoApplicationRejectedEvent`: A bingo application was rejected.
- `BingoInvitationCreatedEvent`: A user was invited to a bingo.
- `BingoInvitationAcceptedEvent`: A bingo invitation was accepted.
- `BingoInvitationRejectedEvent`: A bingo invitation was rejected.
- `BingoParticipantAddedEvent`: A user was added to a bingo.
- `BingoParticipantRemovedEvent`: A user was removed from a bingo.
- `BingoParticipantUpdatedEvent`: A participant's role or team was updated.
- `BingoTeamCreatedEvent`: A team was created within a bingo.
- `BingoTeamUpdatedEvent`: A team was updated.
- `BingoTeamDeletedEvent`: A team was deleted.
- `BingoTileCreatedEvent`: A tile was added to a bingo.
- `BingoTileUpdatedEvent`: A tile was updated.
- `BingoTileDeletedEvent`: A tile was deleted.
- `BingoTileCompletionSubmittedEvent`: A tile completion was submitted.
- `BingoTileCompletionAcceptedEvent`: A tile completion was accepted.
- `BingoTileCompletionRejectedEvent`: A tile completion was rejected.

### Queries

First, we'll need helper queries for pagination; one with total count and the other without total count. Running a SQL count on large tables can be expensive, so we'll use the second one for Bingos and Users.

We will define one type for paginated query params and two for paginated results:

```ts
type PaginatedQueryParams = {
  limit: number;
  offset: number;
};

type PaginatedQueryResult<T> = {
  items: T[];
  limit: number;
  offset: number;
  total: number;
};

type PaginatedQueryResultWithoutTotal<T> = {
  items: T[];
  limit: number;
  offset: number;
  hasPreviousPage: boolean;
  hasNextPage: boolean;
};
```

The `limit` parameter will default to 20 and limit to 50 to prevent large default queries. The `offset` parameter will default to 0.

To get `hasPreviousPage`, we simply check if the `offset` is greater than 0. To get `hasNextPage`, we run the initial query with `limit + 1` and check if the number of results is greater than `limit`, then we remove the last item from the results.

#### `VerifyAuthCodeQuery`

This query needs to be modified to return the code's payload in object form, so the controller can decide what it needs to do with it; either sign in or sign up the user.

#### Other queries

Since the [API endpoints](#api-endpoints) section will be pretty comprehensive, we'll simply list the queries we need to implement:

- `GetBingosQuery`: Retrieves a paginated list of bingo events.
- `GetBingoByIdQuery`: Retrieves a specific bingo event by its ID.
- `GetBingoParticipantsQuery`: Retrieves a list of participants for a bingo.
- `GetBingoTeamsQuery`: Retrieves all teams for a bingo.
- `GetBingoTilesQuery`: Retrieves all tiles for a bingo.
- `GetBingoTileByCoordinatesQuery`: Retrieves a specific tile in a bingo board.
- `GetBingoTileCompletionsQuery`: Retrieves tile completions for a bingo.
- `GetBingoApplicationsQuery`: Retrieves applications for a bingo.
- `GetBingoInvitationsQuery`: Retrieves invitations for a bingo.
- `GetUserByUsernameQuery`: Retrieves a user by their username.
- `GetUsersQuery`: Searches for users by username.

### API endpoints

We will add a `/v1` prefix to all the API endpoints. That way, when we introduce breaking changes, we can divide up the project into different versions without breaking existing applications.

#### Pagination

For search queries, we handle parameters with the `limit` and `offset` query parameters. These parameters are **always optional**.

| Field    | Default | Max |
| -------- | ------- | --- |
| `limit`  | 20      | 50  |
| `offset` | 0       | ∞   |

#### DTOs

##### `PaginatedDto<T>`

```json
{
  "items": [
    // Array of T
  ],
  "limit": 20,
  "offset": 0,
  "total": 100
}
```

##### `PaginatedDtoWithoutTotal<T>`

```json
{
  "items": [
    // Array of T
  ],
  "limit": 20,
  "offset": 0,
  "hasPreviousPage": true,
  "hasNextPage": false
}
```

##### `BingoDto`

```json
{
  "uuid": "00000000-0000-0000-0000-000000000001",
  "language": "en",
  "title": "Sample Bingo",
  "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.",
  "private": false,
  "width": 5,
  "height": 5,
  "fullLineValue": 10,
  "startDate": "2025-03-14",
  "endDate": "2025-04-14",
  "owner": {
    "username": "zezima",
    "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
    "language": "en"
  },
  "startedAt": "number",
  "startedBy": {
    "username": "zezima",
    "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
    "language": "en"
  },
  "endedAt": "number",
  "endedBy": {
    "username": "zezima",
    "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
    "language": "en"
  },
  "cancelledAt": "number",
  "cancelledBy": {
    "username": "zezima",
    "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
    "language": "en"
  }
}
```

#### `BingoTileDto`

```json
{
  "x": 0,
  "y": 0,
  "value": 3,
  "free": false,
  "title": "Obtain a Dragon Scimitar",
  "description": "This should be easy, but don't go fully ape.",
  "completionMode": "all",
  "imageUrl": "https://oldschool.runescape.wiki/images/Dragon_scimitar.png?cc5f3",
  "items": [
    {
      "id": 4587,
      "name": "Dragon Scimitar",
      "imageUrl": "https://oldschool.runescape.wiki/images/Dragon_scimitar.png?cc5f3"
    }
  ]
}
```

#### `BingoApplicationDto`

```json
{
  "uuid": "00000000-0000-0000-0000-000000000001",
  "team": {
    "name": "73 Gang",
    "nameNormalized": "73-gang",
    "captain": {
      "username": "zezima",
      "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
      "language": "en"
    },
    "points": 73
  },
  "user": {
    "username": "b0aty",
    "gravatarHash": "9d781c7ea7b209243b7e7eae11cb28b70a2649be5dfe1cde60dfac827fe27433",
    "language": "en"
  },
  "bingo": {
    "uuid": "00000000-0000-0000-0000-000000000001",
    "language": "en",
    "title": "Sample Bingo",
    "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.",
    "private": false,
    "width": 5,
    "height": 5,
    "fullLineValue": 10,
    "startDate": "2025-03-14",
    "endDate": "2025-04-14",
    "owner": {
      "username": "zezima",
      "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
      "language": "en"
    },
    "startedAt": "number",
    "startedBy": {
      "username": "zezima",
      "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
      "language": "en"
    },
    "endedAt": "number",
    "endedBy": {
      "username": "zezima",
      "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
      "language": "en"
    },
    "cancelledAt": "number",
    "cancelledBy": {
      "username": "zezima",
      "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
      "language": "en"
    }
  },
  "acceptedAt": 1742154073,
  "acceptedBy": {
    "username": "zezima",
    "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
    "language": "en"
  },
  "rejectedAt": null,
  "rejectedBy": null
}
```

#### `BingoInvitationDto`

```json
{
  "uuid": "00000000-0000-0000-0000-000000000001",
  "team": {
    "name": "73 Gang",
    "nameNormalized": "73-gang",
    "captain": {
      "username": "zezima",
      "usernameNormalized": "zezima",
      "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
      "language": "en",
      "role": "user"
    },
    "points": 73
  },
  "sender": {
    "username": "zezima",
    "usernameNormalized": "zezima",
    "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
    "language": "en",
    "role": "user"
  },
  "recipient": {
    "username": "b0aty",
    "usernameNormalized": "b0aty",
    "gravatarHash": "9d781c7ea7b209243b7e7eae11cb28b70a2649be5dfe1cde60dfac827fe27433",
    "language": "en",
    "role": "user"
  },
  "bingo": {
    "uuid": "00000000-0000-0000-0000-000000000001",
    "language": "en",
    "title": "Sample Bingo",
    "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.",
    "private": false,
    "width": 5,
    "height": 5,
    "fullLineValue": 10,
    "startDate": "2025-03-14",
    "endDate": "2025-04-14",
    "owner": {
      "username": "zezima",
      "usernameNormalized": "zezima",
      "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
      "language": "en",
      "role": "user"
    },
    "startedAt": "number",
    "startedBy": {
      "username": "zezima",
      "usernameNormalized": "zezima",
      "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
      "language": "en",
      "role": "user"
    },
    "endedAt": "number",
    "endedBy": {
      "username": "zezima",
      "usernameNormalized": "zezima",
      "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
      "language": "en",
      "role": "user"
    },
    "cancelledAt": "number",
    "cancelledBy": {
      "username": "zezima",
      "usernameNormalized": "zezima",
      "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
      "language": "en",
      "role": "user"
    }
  },
  "acceptedAt": 1742154073,
  "acceptedBy": {
    "username": "b0aty",
    "usernameNormalized": "b0aty",
    "gravatarHash": "9d781c7ea7b209243b7e7eae11cb28b70a2649be5dfe1cde60dfac827fe27433",
    "language": "en",
    "role": "user"
  },
  "rejectedAt": null,
  "rejectedBy": null
}
```

##### `BingoParticipantDto`

```json
{
  "team": {
    "name": "73 Gang",
    "nameNormalized": "73-gang",
    "captain": {
      "username": "zezima",
      "usernameNormalized": "zezima",
      "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
      "language": "en",
      "role": "user"
    }
  },
  "user": {
    "username": "b0aty",
    "usernameNormalized": "b0aty",
    "gravatarHash": "9d781c7ea7b209243b7e7eae11cb28b70a2649be5dfe1cde60dfac827fe27433",
    "language": "en",
    "role": "user"
  },
  "role": "participant"
}
```

##### `BingoTeamDto`

```json
{
  "name": "73 Gang",
  "nameNormalized": "73-gang",
  "captain": {
    "username": "zezima",
    "usernameNormalized": "zezima",
    "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
    "language": "en",
    "role": "user"
  },
  "points": 73
}
```

##### `BingoTileCompletionDto`

```json
{
  "uuid": "00000000-0000-0000-0000-000000000001",
  "x": 0,
  "y": 0,
  "team": {
    "name": "73 Gang",
    "nameNormalized": "73-gang",
    "captain": {
      "username": "zezima",
      "usernameNormalized": "zezima",
      "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
      "language": "en",
      "role": "user"
    }
  },
  "user": {
    "username": "b0aty",
    "usernameNormalized": "b0aty",
    "gravatarHash": "9d781c7ea7b209243b7e7eae11cb28b70a2649be5dfe1cde60dfac827fe27433",
    "language": "en",
    "role": "user"
  },
  "imageUrl": "https://i.imgur.com/1.png",
  "acceptedAt": 1742154073,
  "acceptedBy": {
    "username": "zezima",
    "usernameNormalized": "zezima",
    "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
    "language": "en",
    "role": "user"
  },
  "rejectedAt": null,
  "rejectedBy": null
}
```

##### `UserDto`

```json
{
  "username": "zezima",
  "usernameNormalized": "zezima",
  "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
  "language": "en",
  "role": "user"
}
```

##### `ActivityDto`

```json
{
  "key": "bingo.updated",
  "createdAt": 1742154073,
  "createdBy": {
    "username": "zezima",
    "usernameNormalized": "zezima",
    "gravatarHash": "adb3c6dc793cb35caa69861e63f39e3d5f41dcb59a310c57114913b5dc80e67d",
    "language": "en",
    "role": "user"
  },
  "trackable": {
    // The entity being tracked (e.g. BingoDto, UserDto)
  },
  "title": "Sample Bingo (updated)",
  "body": ["Set the title to 'Sample Bingo (updated)'", "Set the full line value to 73"]
}
```

#### <kbd>POST</kbd> `/v1/auth/sign-up`

Requests a registration code to be sent to the user's email to create a new account, if available. Logs the registration code to the console in development.

##### Body Params

```json
{
  "email": "string",
  "username": "string"
}
```

##### Responses

- 204: The sign up code has been sent to the user's email.
- 400: The email or username is invalid.
- 409: The email or username is already taken.

#### <kbd>POST</kbd> `/v1/auth/sign-in`

**Remove**: `/email/` from the path.

#### <kbd>POST</kbd> `/v1/auth/verify`

**Change**:

- Path changes from `/auth/email/verify-code` to `/auth/verify`.
- If the code's action is `sign-up` and the user already exists, the response will be a 409 status code.
- If the code's action is `sign-in` and the user doesn't exist, the response will be a 404 status code.

#### <kbd>GET</kbd> `/v1/users`

Search for users by their username normalized.

| Field    | Type   | Required | Description                                                                                                                                    |
| -------- | ------ | -------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| `search` | string | `true`   | The username to search for.                                                                                                                    |
| `status` | string | `false`  | The status of the users. Can be `active`, `disabled` or `null`. The requester must be a moderator or admin for this parameter to be effective. |
| `limit`  | number | `true`   | See [Pagination](#pagination).                                                                                                                 |
| `offset` | number | `true`   | See [Pagination](#pagination).                                                                                                                 |

Returns a [PaginatedDtoWithoutTotal](#paginateddtowithouttotalt)<[UserDto](#userdto)>.

#### <kbd>GET</kbd> `/v1/users/:username`

Retrieve a user by their username.

Returns a [UserDto](#userdto), or a 404 status code if the user doesn't exist.

#### <kbd>PUT</kbd> `/v1/users/:username`

Update a user by their username.

##### Body Params

```json
{
  "username": "string",
  "language": "string",
  "role": "string"
}
```

All fields are optional. The requester must be an admin to change the role of the user. A moderator can change the username and language of another user.

##### Responses

- 200: The user has been updated. The updated user is returned as a [UserDto](#userdto).
- 400: The username, language, or the role is invalid.
- 403: The requester is not allowed to update the user. Must either be the user themselves, or a moderator or admin.
- 404: The user doesn't exist.

#### <kbd>GET</kbd> `/v1/users/:username/activities`

Retrieve the activities for a user. The requester must be the user themselves, or a moderator/admin to see the activities.

| Field    | Type   | Required | Description                                           |
| -------- | ------ | -------- | ----------------------------------------------------- |
| `query`  | string | `false`  | A query string to search from the activity's content. |
| `limit`  | number | `true`   | See [Pagination](#pagination).                        |
| `offset` | number | `true`   | See [Pagination](#pagination).                        |

Returns a [PaginatedDtoWithoutTotal](#paginateddtowithouttotalt)<[ActivityDto](#activitydto)>. The activities are sorted by creation date, in descending order.

##### Responses

- 200: The activities have been retrieved.
- 403: The requester is not allowed to view the activities. Must either be the user themselves or a moderator/admin.
- 404: The user doesn't exist.

#### <kbd>GET</kbd> `/v1/bingos`

Search for bingo events.

| Field       | Type    | Required | Description                                                                                                                                                                       |
| ----------- | ------- | -------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `query`     | string  | `false`  | A query string to search from the bingo's title or description.                                                                                                                   |
| `createdBy` | string  | `false`  | The username of the user who created the bingo.                                                                                                                                   |
| `status`    | string  | `false`  | The status of the bingo. Can be `pending`, `started`, `ended`, or `cancelled`.                                                                                                    |
| `private`   | boolean | `false`  | Whether the search should include private bingos (`true`) or exclude them. If it is not specified, the results will include public bingos, as well as private bingos you can see. |
| `limit`     | number  | `true`   | See [Pagination](#pagination).                                                                                                                                                    |
| `offset`    | number  | `true`   | See [Pagination](#pagination).                                                                                                                                                    |

Private bingos can only be seen if :

- you are the creator of the bingo,
- you are one of its participants,
- you have an invitation to join it, or
- you are a moderator or admin.

Returns a [PaginatedDtoWithoutTotal](#paginateddtowithouttotalt)<[BingoDto](#bingodto)>.

#### <kbd>POST</kbd> `/v1/bingos`

Create a new bingo event. A user may only organize one pending or ongoing bingo at a time.

##### Body Params

| Field           | Type                | Required | Description                                                                              |
| --------------- | ------------------- | -------- | ---------------------------------------------------------------------------------------- |
| `language`      | string              | `true`   | The language in which communications for this bingo are made. Can be `en` or `fr`.       |
| `title`         | string              | `true`   | The title of the bingo event.                                                            |
| `description`   | string              | `true`   | The description of the bingo event. Supports HTML syntax.                                |
| `private`       | boolean             | `true`   | Whether the bingo event is private or not.                                               |
| `width`         | number              | `true`   | The width of the bingo board. Must be a positive integer.                                |
| `height`        | number              | `true`   | The height of the bingo board. Must be a positive integer.                               |
| `fullLineValue` | number              | `true`   | The amount of points a team gets for completing a full line. Must be a positive integer. |
| `startDate`     | string (YYYY-MM-DD) | `false`  | The date at which the bingo is expected to start.                                        |
| `endDate`       | string (YYYY-MM-DD) | `false`  | The date at which the bingo is expected to end.                                          |

##### Responses

- 201: The bingo has been created. The created bingo is returned as a [BingoDto](#bingodto).
- 400: The title, description, width, height, or fullLineValue is invalid, or the user is already organizing a pending or ongoing bingo.

#### <kbd>GET</kbd> `/v1/bingos/:slug`

Retrieve a bingo event by its ID.

Returns a [BingoDto](#bingodto), or a 404 status code if the bingo doesn't exist, or if the requester is not allowed to see it.

#### <kbd>PUT</kbd> `/v1/bingos/:slug`

Update a bingo event by its ID. The bingo must be pending for the requester to be able to update it.

##### Body Params

| Field           | Type                | Required | Description                                                                              |
| --------------- | ------------------- | -------- | ---------------------------------------------------------------------------------------- |
| `language`      | string              | `false`  | The language in which communications for this bingo are made. Can be `en` or `fr`.       |
| `title`         | string              | `false`  | The title of the bingo event.                                                            |
| `description`   | string              | `false`  | The description of the bingo event. Supports HTML syntax.                                |
| `private`       | boolean             | `false`  | Whether the bingo event is private or not.                                               |
| `fullLineValue` | number              | `false`  | The amount of points a team gets for completing a full line. Must be a positive integer. |
| `startDate`     | string (YYYY-MM-DD) | `false`  | The date at which the bingo is expected to start.                                        |
| `endDate`       | string (YYYY-MM-DD) | `false`  | The date at which the bingo is expected to end.                                          |

##### Responses

- 200: The bingo has been updated. The updated bingo is returned as a [BingoDto](#bingodto).
- 400: The title, description, or fullLineValue is invalid, or the bingo is not pending.
- 403: The requester is not allowed to update the bingo. Must either be the owner a moderator or admin.

#### <kbd>GET</kbd> `/v1/bingos/:slug/activities`

Retrieve the activities for a bingo event. The requester must be the owner or an organizer to see the activities.

| Field    | Type   | Required | Description                                                    |
| -------- | ------ | -------- | -------------------------------------------------------------- |
| `query`  | string | `false`  | A query string to search from the activity's owner or content. |
| `limit`  | number | `true`   | See [Pagination](#pagination).                                 |
| `offset` | number | `true`   | See [Pagination](#pagination).                                 |

Returns a [PaginatedDtoWithoutTotal](#paginateddtowithouttotalt)<[ActivityDto](#activitydto)>. The activities are sorted by creation date, in descending order.

#### <kbd>POST</kbd> `/v1/bingos/:slug/start`

Start a bingo event. The bingo must be pending and the requester must be the owner or an organizer to start it.

##### Responses

- 200: The bingo has been started. The started bingo is returned as a [BingoDto](#bingodto).
- 403: The requester is not allowed to start the bingo. Must either be the owner or an organizer.
- 404: The bingo doesn't exist, or if the requester is not allowed to see it.

#### <kbd>POST</kbd> `/v1/bingos/:slug/end`

End a bingo event. The bingo must be started and the requester must be the owner or an organizer to end it.

##### Responses

- 200: The bingo has been ended. The ended bingo is returned as a [BingoDto](#bingodto).
- 403: The requester is not allowed to end the bingo. Must either be the owner or an organizer.
- 404: The bingo doesn't exist, or if the requester is not allowed to see it.

#### <kbd>POST</kbd> `/v1/bingos/:slug/cancel`

Cancel a bingo event. The bingo must be pending or ongoing and the requester must be the owner to cancel it.

##### Responses

- 200: The bingo has been cancelled. The cancelled bingo is returned as a [BingoDto](#bingodto).
- 403: The requester is not allowed to cancel the bingo. Must either be the owner or an organizer.
- 404: The bingo doesn't exist, or if the requester is not allowed to see it.

#### <kbd>DELETE</kbd> `/v1/bingos/:slug`

Delete a bingo event. The associated tiles, applications, invitations, participants and teams will be deleted as well. The requester must be the owner to delete it.

#### <kbd>GET</kbd> `/v1/bingos/:slug/applications`

Retrieve the applications for a bingo event.

| Field    | Type   | Required | Description                                                                  |
| -------- | ------ | -------- | ---------------------------------------------------------------------------- |
| `status` | string | `false`  | The status of the applications. Can be `pending`, `accepted`, or `rejected`. |
| `limit`  | number | `true`   | See [Pagination](#pagination).                                               |
| `offset` | number | `true`   | See [Pagination](#pagination).                                               |

Returns a [PaginatedDto](#paginateddtot)<[BingoApplicationDto](#bingoapplicationdto)>.

#### <kbd>POST</kbd> `/v1/bingos/:slug/applications`

Apply to a bingo event. The requester must not already be a participant or have an application pending for the bingo. They must also be able to see the bingo. They may specify a Team name to apply as part of that team.

##### Body Params

| Field      | Type   | Required | Description                                                         |
| ---------- | ------ | -------- | ------------------------------------------------------------------- |
| `teamName` | string | `false`  | The normalized name of the team the user wants to apply as part of. |

##### Responses

- 201: The application has been created. The created application is returned as a [BingoApplicationDto](#bingoapplicationdto).
- 400: The team name is invalid, or the requester is already a participant or has an application pending for the bingo.
- 404: The bingo doesn't exist, or if the requester is not allowed to see it.

#### <kbd>GET</kbd> `/v1/bingos/applications/:applicationId`

Retrieve an application for a bingo event.

Returns a [BingoApplicationDto](#bingoapplicationdto), or a 404 status code if the bingo or the application doesn't exist, or if the requester is not allowed to see it.

#### <kbd>DELETE</kbd> `/v1/bingos/applications/:applicationId`

Cancel an application for a bingo event. The requester must be the applicant, or the owner or an organizer of the bingo.

##### Responses

- 204: The application has been cancelled.
- 403: The requester is not allowed to cancel the application. Must either be the applicant, or the owner or an organizer of the bingo.
- 404: The bingo or the application doesn't exist, or if the requester is not allowed to see it.

#### <kbd>POST</kbd> `/v1/bingos/applications/:applicationId/accept`

Accept an application for a bingo event. The requester must be the owner or an organizer of the bingo. The application must be pending. The requester may specify a different team for the applicant to join.

##### Body Params

| Field      | Type            | Required | Description                                         |
| ---------- | --------------- | -------- | --------------------------------------------------- |
| `teamName` | string, or null | `false`  | The normalized name of the team the user will join. |

#### <kbd>POST</kbd> `/v1/bingos/applications/:applicationId/reject`

Reject an application for a bingo event. The requester must be the owner or an organizer of the bingo. The application must be pending.

#### <kbd>GET</kbd> `/v1/bingos/:slug/invitations`

Retrieve the applications for a bingo event, or a 404 status code if the bingo doesn't exist, or if the requester is not allowed to see it.

| Field    | Type   | Required | Description                                                                  |
| -------- | ------ | -------- | ---------------------------------------------------------------------------- |
| `status` | string | `false`  | The status of the applications. Can be `pending`, `accepted`, or `rejected`. |
| `limit`  | number | `true`   | See [Pagination](#pagination).                                               |
| `offset` | number | `true`   | See [Pagination](#pagination).                                               |

Returns a [PaginatedDto](#paginateddtot)<[BingoApplicationDto](#bingoapplicationdto)>, or a 404 status code if the bingo doesn't exist, or if the requester is not allowed to see it.

#### <kbd>POST</kbd> `/v1/bingos/:slug/invitations`

Invite a user to a bingo event. The requester must be the owner or an organizer of the bingo. The bingo must be pending. The user must not already be a participant or have an invitation pending for the bingo.

##### Body Params

| Field      | Type   | Required | Description                                                        |
| ---------- | ------ | -------- | ------------------------------------------------------------------ |
| `username` | string | `true`   | The username of the user to invite.                                |
| `teamName` | string | `false`  | The normalized name of the team the user will join if they accept. |

##### Responses

- 201: The invitation has been created. The created invitation is returned as a [BingoInvitationDto](#bingoinvitationdto).
- 400: The username or team name is invalid, the bingo is already started, ended or canceled, or the user is already a participant or has an invitation pending for the bingo.
- 404: The bingo or the receiver doesn't exist, or if the requester is not allowed to see it.

#### <kbd>GET</kbd> `/v1/bingos/invitations/:invitationId`

Retrieve an invitation for a bingo event. The requester must be able to see the bingo.

Returns a [BingoInvitationDto](#bingoinvitationdto), or a 404 status code if the bingo or the invitation doesn't exist, or if the requester is not allowed to see it.

#### <kbd>DELETE</kbd> `/v1/bingos/invitations/:invitationId`

Cancel an invitation for a bingo event. The requester must be the sender, or the owner or an organizer of the bingo.

##### Responses

- 204: The invitation has been cancelled.
- 403: The requester is not allowed to cancel the invitation. Must either be the sender, or the owner or an organizer of the bingo.
- 404: The bingo or the invitation doesn't exist, or if the requester is not allowed to see it.

#### <kbd>POST</kbd> `/v1/bingos/invitations/:invitationId/accept`

Accept an invitation for a bingo event. The requester must be the receiver. The invitation must be pending.

##### Responses

- 204: The invitation has been accepted.
- 403: The requester is not allowed to accept the invitation. Must be the receiver.
- 404: The bingo or the invitation doesn't exist, or if the requester is not allowed to see it.

#### <kbd>POST</kbd> `/v1/bingos/invitations/:invitationId/reject`

Reject an invitation for a bingo event. The requester must be the receiver. The invitation must be pending.

##### Responses

- 204: The invitation has been rejected.
- 403: The requester is not allowed to reject the invitation. Must be the receiver.
- 404: The bingo or the invitation doesn't exist, or if the requester is not allowed to see it.

#### <kbd>GET</kbd> `/v1/bingos/:slug/participants`

Retrieve the participants for a bingo event, or a 404 status code if the bingo doesn't exist, or if the requester is not allowed to see it.

| Field      | Type   | Required | Description                                                                     |
| ---------- | ------ | -------- | ------------------------------------------------------------------------------- |
| `query`    | string | `false`  | A query string to search from the participant's username, or their team's name. |
| `role`     | string | `false`  | The role of the participants. Can be `participant`, `organizer`, or `owner`.    |
| `teamName` | number | `false`  | The normalized name of the team the participants are part of.                   |
| `limit`    | number | `true`   | See [Pagination](#pagination).                                                  |
| `offset`   | number | `true`   | See [Pagination](#pagination).                                                  |

Returns a [PaginatedDto](#paginateddtot)<[BingoParticipantDto](#bingoparticipantdto)>, or a 404 status code if the bingo doesn't exist, or if the requester is not allowed to see it.

#### <kbd>GET</kbd> `/v1/bingos/:slug/participants/:username`

Retrieve a participant for a bingo event, or a 404 status code if the bingo or the participant doesn't exist, or if the requester is not allowed to see it.

Returns a [BingoParticipantDto](#bingoparticipantdto), or a 404 status code if the bingo or the participant doesn't exist, or if the requester is not allowed to see it.

#### <kbd>DELETE</kbd> `/v1/bingos/:slug/participants/:username`

Remove a participant from a bingo event. The requester must be the owner or an organizer of the bingo, or the participant themselves.

#### <kbd>PUT</kbd> `/v1/bingos/:slug/participants/:username`

Update a participant's role or team in a bingo event. The requester must be the owner or an organizer of the bingo, or the participant themselves. The bingo must be pending.

##### Body Params

| Field      | Type   | Required | Description                                                                 |
| ---------- | ------ | -------- | --------------------------------------------------------------------------- |
| `role`     | string | `false`  | The role of the participant. Can be `participant`, `organizer`, or `owner`. |
| `teamName` | string | `false`  | The normalized name of the team the participant will join.                  |

##### Responses

- 200: The participant has been updated. The updated participant is returned as a [BingoParticipantDto](#bingoparticipantdto).
- 400: The role or team name is invalid, or the bingo is not pending.
- 403: The requester is not allowed to update the participant. Must either be the owner or an organizer of the bingo, or the participant themselves.
- 404: The bingo or the participant doesn't exist, or if the requester is not allowed to see it.

#### <kbd>GET</kbd> `/v1/bingos/:slug/teams`

Retrieve the teams for a bingo event, or a 404 status code if the bingo doesn't exist, or if the requester is not allowed to see it.

Returns an array of [BingoTeamDto](#bingoteamdto), or a 404 status code if the bingo doesn't exist, or if the requester is not allowed to see it.

#### <kbd>POST</kbd> `/v1/bingos/:slug/teams`

Create a new team for a bingo event. The requester must be the owner or an organizer of the bingo. The bingo must be pending.

##### Body Params

| Field     | Type   | Required | Description                                                                     |
| --------- | ------ | -------- | ------------------------------------------------------------------------------- |
| `name`    | string | `true`   | The name of the team to create.                                                 |
| `captain` | string | `false`  | The username of the team's captain. Must already be participating to the bingo. |

##### Responses

- 201: The team has been created. The created team is returned as a [BingoTeamDto](#bingoteamdto).
- 400: The name or captain is invalid, or the bingo is not pending.
- 403: The requester is not allowed to create the team. Must either be the owner or an organizer of the bingo.
- 404: The bingo or the captain doesn't exist, or if the requester is not allowed the bingo.

#### <kbd>GET</kbd> `/v1/bingos/:slug/teams/:teamName`

Retrieve a team for a bingo event, or a 404 status code if the bingo or the team doesn't exist, or if the requester is not allowed to see it.

Returns a [BingoTeamDto](#bingoteamdto), or a 404 status code if the bingo or the team doesn't exist, or if the requester is not allowed to see it.

#### <kbd>PUT</kbd> `/v1/bingos/:slug/teams/:teamName`

Update a team for a bingo event. The requester must be the owner or an organizer of the bingo. The bingo must be pending.

##### Body Params

| Field     | Type   | Required | Description                                                                     |
| --------- | ------ | -------- | ------------------------------------------------------------------------------- |
| `name`    | string | `false`  | The name of the team to update.                                                 |
| `captain` | string | `false`  | The username of the team's captain. Must already be participating to the bingo. |

##### Responses

- 200: The team has been updated. The updated team is returned as a [BingoTeamDto](#bingoteamdto).
- 400: The name or captain is invalid, or the bingo is not pending.
- 403: The requester is not allowed to update the team. Must either be the owner or an organizer of the bingo.
- 404: The captain, bingo or the team doesn't exist, or if the requester is not allowed to see it.

#### <kbd>DELETE</kbd> `/v1/bingos/:slug/teams/:teamName`

Delete a team for a bingo event. The requester must be the owner or an organizer of the bingo. The team must not have any participants. The participants will be unassigned from their team.

##### Responses

- 204: The team has been deleted.
- 403: The requester is not allowed to delete the team. Must either be the owner or an organizer of the bingo.
- 404: The bingo or the team doesn't exist, or if the requester is not allowed to see it.

#### <kbd>GET</kbd> `/v1/bingos/:slug/tiles`

Retrieve the tiles for a bingo event, or a 404 status code if the bingo doesn't exist, or if the requester is not allowed to see it.

Returns an array of [BingoTileDto](#bingotiledto), or a 404 status code if the bingo doesn't exist, or if the requester is not allowed to see it.

#### <kbd>GET</kbd> `/v1/bingos/:slug/tiles/:x/:y`

Retrieve a tile for a bingo event, or a 404 status code if the bingo or the tile doesn't exist, or if the requester is not allowed to see it.

Returns a [BingoTileDto](#bingotiledto), or a 404 status code if the bingo or the tile doesn't exist, or if the requester is not allowed to see it.

#### <kbd>PUT</kbd> `/v1/bingos/:slug/tiles/:x/:y`

Set or update a tile for a bingo event. The requester must be the owner or an organizer of the bingo. The bingo must be pending.

##### Body Params

| Field            | Type                                 | Required | Description                                                                |
| ---------------- | ------------------------------------ | -------- | -------------------------------------------------------------------------- |
| `value`          | number                               | `true`   | The value of the tile. Must be a positive integer.                         |
| `free`           | boolean                              | `true`   | Whether the tile is free or not.                                           |
| `title`          | string                               | `true`   | The title of the tile.                                                     |
| `description`    | string                               | `true`   | The description of the tile. Supports HTML syntax.                         |
| `completionMode` | string                               | `true`   | The completion mode of the tile. Can be `manual`, `automatic`, or `mixed`. |
| `imageUrl`       | string                               | `false`  | The URL of the image of the tile.                                          |
| `itemIds`        | `{ id: number, quantity: number }[]` | `false`  | The IDs of the items of the tile.                                          |

##### Responses

- 200: The tile has been updated. The updated tile is returned as a [BingoTileDto](#bingotiledto).
- 400: The value, title, description, completionMode, imageUrl, or itemIds is invalid, or the bingo is not pending.
- 403: The requester is not allowed to update the tile. Must either be the owner or an organizer of the bingo.
- 404: The bingo or the tile doesn't exist, or if the requester is not allowed to see it.

#### <kbd>DELETE</kbd> `/v1/bingos/:slug/tiles/:x/:y`

Delete a tile for a bingo event. The requester must be the owner or an organizer of the bingo. The bingo must be pending.

##### Responses

- 204: The tile has been deleted.
- 403: The requester is not allowed to delete the tile. Must either be the owner or an organizer of the bingo.
- 404: The bingo or a specified item doesn't exist, or if the requester is not allowed to see it.

#### <kbd>GET</kbd> `/v1/bingos/:slug/tile-completions`

Retrieve the tile completions for a bingo event, or a 404 status code if the bingo doesn't exist, or if the requester is not allowed to see it.

| Field      | Type   | Required | Description                                                                 |
| ---------- | ------ | -------- | --------------------------------------------------------------------------- |
| `status`   | string | `false`  | The status of the completions. Can be `pending`, `accepted`, or `rejected`. |
| `teamName` | string | `false`  | The normalized name of the team the completions are for.                    |
| `limit`    | number | `true`   | See [Pagination](#pagination).                                              |
| `offset`   | number | `true`   | See [Pagination](#pagination).                                              |

Returns a [PaginatedDto](#paginateddtot)<[BingoTileCompletionDto](#bingotilecompletiondto)>, or a 404 status code if the bingo doesn't exist, or if the requester is not allowed to see it.

#### <kbd>POST</kbd> `/v1/bingos/:slug/tile-completions`

Complete a tile for a bingo event. The requester must be a participant of the bingo. The tile must not be free. The tile must not already be completed by the requester's team.

##### Body Params

| Field      | Type   | Required | Description                                                           |
| ---------- | ------ | -------- | --------------------------------------------------------------------- |
| `x`        | number | `true`   | The x-coordinate of the tile to complete. Must be a positive integer. |
| `y`        | number | `true`   | The y-coordinate of the tile to complete. Must be a positive integer. |
| `imageUrl` | string | `true`   | The URL of the image of the completion.                               |

##### Responses

- 201: The completion has been created. The created completion is returned as a [BingoTileCompletionDto](#bingotilecompletiondto).
- 400: The x, y, or imageUrl is invalid, or the tile is free, or the tile is already completed by the requester's team.
- 404: The bingo or the tile doesn't exist, or if the requester is not allowed to see it.

#### <kbd>GET</kbd> `/v1/bingos/tile-completions/:completionId`

Retrieve a tile completion for a bingo event, or a 404 status code if the bingo or the completion doesn't exist, or if the requester is not allowed to see it.

Returns a [BingoTileCompletionDto](#bingotilecompletiondto), or a 404 status code if the bingo or the completion doesn't exist, or if the requester is not allowed to see it.

#### <kbd>DELETE</kbd> `/v1/bingos/tile-completions/:completionId`

Delete a tile completion for a bingo event. The requester must be the completer, or the owner or an organizer of the bingo.

##### Responses

- 204: The completion has been deleted.
- 403: The requester is not allowed to delete the completion. Must either be the completer, or the owner or an organizer of the bingo.
- 404: The bingo or the completion doesn't exist, or if the requester is not allowed to see it.

#### <kbd>POST</kbd> `/v1/bingos/tile-completions/:completionId/accept`

Accept a tile completion for a bingo event. The requester must be the owner or an organizer of the bingo. The completion must be pending.

##### Responses

- 204: The completion has been accepted.
- 403: The requester is not allowed to accept the completion. Must either be the owner or an organizer of the bingo.
- 404: The bingo or the completion doesn't exist, or if the requester is not allowed to see it.

#### <kbd>POST</kbd> `/v1/bingos/tile-completions/:completionId/reject`

Reject a tile completion for a bingo event. The requester must be the owner or an organizer of the bingo. The completion must be pending.

##### Responses

- 204: The completion has been rejected.
- 403: The requester is not allowed to reject the completion. Must either be the owner or an organizer of the bingo.
- 404: The bingo or the completion doesn't exist, or if the requester is not allowed to see it.

## Emails

We will create a stylized email template, then add the following emails:

- Welcome email, once the user has signed up.
- Notification emails, when:
  - The user has been invited to a bingo, or their application has been accepted or rejected.
  - Their tile completion has been accepted or rejected.
  - A user has applied to a bingo they own or organize.
  - A user has submitted a tile completion for a bingo they own or organize.
- Reminder emails, when:
  - A bingo they own or organize is about to start, the day before. Reminds them that once it is started, teams and tiles can no longer be modified.
  - A bingo they own or organize is about to end, the day before. Reminds them to approve the final tile completions.
  - A bingo they participate in is about to start, the day before. Reminds them to participate and enjoy the event.
  - A bingo they participate in is about to end, the day before. Reminds them to submit their tile completions.
- Summary emails, when:
  - A bingo they own, organize or participate in has ended. Summarizes the event, the teams, the tile completions, and the winners.

## Frontend

The frontend application will be made with [Next.js](https://nextjs.org/) to allow us to have static and server-side rendered-pages.

The design system will be made with [shadcn/ui](https://ui.shadcn.com/). The long term goal of the design system is to make sure that all the components are reusable and ready to drop on a page, without needing to style them.

### Architecture

Since Next.js is a fullstack framework, we will leverage its server-side capabilities to fetch data from the API and render the pages with the data directly. This will allow us to have a fast and SEO-friendly application.

Here is how the authentication flow will work:

1. **User signs in via the Next.js frontend**

   The frontend sends a request to the Next.js backend with login credentials.

2. **Next.js backend forwards the request to the NestJS API**

   The Next.js backend acts as a proxy, handling authentication requests and passing them to the Nest.js API.

3. **NestJS API verifies credentials and returns a session cookie (or token)**

   The Nest.js API issues a session cookie (e.g., Set-Cookie header).

4. **Next.js backend forwards the cookie to the frontend**

5. **Next.js frontend stores the cookie in a secure cookie store**

   The frontend stores the cookie in a secure cookie store and now includes it in all subsequent requests.

### Pages

#### Home

<kbd>/</kbd>

The landing page of the application. Has a hero with a call to action to sign up or sign in. Showcases the application's basic features.

#### Bingos

<kbd>/bingos</kbd>

Index of public bingos. Shown in a table, with a search bar to filter them. Authenticated users will see buttons to apply to these bingos.

#### View Bingo

<kbd>/bingos/:slug</kbd>

Either a public page for a bingo, or a private page for a bingo the user is participating in.

- The title, description, status, expected dates, tiles, teams and participants are public.
- The applications and invitations are only shown to the owner and organizers.
- The user can apply to the bingo if it is public.
- The owner and organizers can update the bingo, start, end, or cancel it.
- The owner and organizers can manage the applications, invitations, participants, teams, and tiles.
- The owner and organizers can view an activity log of the bingo.

#### Dashboard

<kbd>/dashboard</kbd>

The user's dashboard. Shows the user's bingos, pending applications, invitations, and tile completions.

#### Profile

<kbd>/me</kbd>

User's profile management page. Allows the user to update their username and language. They can also see an activity log of their actions.
